<!DOCTYPE html>
<html>

<head>
    
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="chrome=1">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="referrer" content="no-referrer">

<meta name="description" content="Hugo-Primer theme&#39;s example site">
<title>
    新年彩蛋之中大奖 - 渐行渐远
</title>









<link rel="stylesheet" href="/css/main.min.670da4c21f08f6fb9346ba65b362026a143c88c6d6e4292b05476774b0516a42.css" integrity="sha256-Zw2kwh8I9vuTRrpls2ICahQ8iMbW5CkrBUdndLBRakI=" crossorigin="anonymous" media="screen">





<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Didact+Gothic">

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="新年彩蛋之中大奖"/>
<meta name="twitter:description" content="2019年计划通过福利彩票发家致富的，可以好好看一看这篇博客。作为新年彩蛋来送给大家，也希望大家能真的中大奖。—— 新年快乐，给每个有梦想的程"/>

<meta property="og:title" content="新年彩蛋之中大奖" />
<meta property="og:description" content="2019年计划通过福利彩票发家致富的，可以好好看一看这篇博客。作为新年彩蛋来送给大家，也希望大家能真的中大奖。—— 新年快乐，给每个有梦想的程" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://neojos.com/blog/2019/19-02-08-%E6%96%B0%E5%B9%B4%E5%BD%A9%E8%9B%8B%E4%B9%8B%E4%B8%AD%E5%A4%A7%E5%A5%96/" />
<meta property="article:published_time" content="2019-02-09T00:00:00&#43;00:00"/>
<meta property="article:modified_time" content="2019-02-09T00:00:00&#43;00:00"/>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-12345678-0', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

    

    
    
    
    <title>
        
        新年彩蛋之中大奖
        
    </title>
</head>

<body>
    
    
    <header class="wrap flex-container">
        <h1>新年彩蛋之中大奖</h1>
    </header>
    
    <main class="wrap">
        
        <article role="article" class="flex-container">

<blockquote>
<p><code>2019年计划通过福利彩票发家致富的，可以好好看一看这篇博客。作为新年彩蛋来送给大家，也希望大家能真的中大奖。—— 新年快乐，给每个有梦想的程序员</code></p>
</blockquote>

<h2 id="生成随机号">生成随机号</h2>

<p>小概率事件也要做的一丝不苟，大家都是程序员，为啥要用别人家写的随机代码。嘎嘎！</p>

<p>双色球蓝号1-12、红号1-33，非常简单，只需保证生成的红号不相互重复就可以，然后就是考虑如何做到真正的<code>随机</code>。</p>

<p>还有一个问题就是如何存储一组号码。首先，分成红区和蓝区两部分，最后一个号约定为蓝号。另外，为了方便存储，我们放弃了将每个数字用符号连接的方式，而是自定义了<code>34进制</code>，用于保证每组号码的长度都是7。</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">var</span> <span class="nx">redBall</span> <span class="p">=</span> <span class="kd">map</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="kt">rune</span><span class="p">{</span>
	<span class="mi">1</span><span class="p">:</span>  <span class="sc">&#39;1&#39;</span><span class="p">,</span>
	<span class="mi">2</span><span class="p">:</span>  <span class="sc">&#39;2&#39;</span><span class="p">,</span>
	<span class="mi">3</span><span class="p">:</span>  <span class="sc">&#39;3&#39;</span><span class="p">,</span>
	<span class="c1">//......
</span><span class="c1"></span>	<span class="mi">31</span><span class="p">:</span> <span class="sc">&#39;V&#39;</span><span class="p">,</span>
	<span class="mi">32</span><span class="p">:</span> <span class="sc">&#39;W&#39;</span><span class="p">,</span>
	<span class="mi">33</span><span class="p">:</span> <span class="sc">&#39;X&#39;</span><span class="p">,</span>
<span class="p">}</span>
<span class="kd">var</span> <span class="nx">redFlip</span> <span class="p">=</span> <span class="kd">map</span><span class="p">[</span><span class="kt">rune</span><span class="p">]</span><span class="kt">int</span><span class="p">{</span>
	<span class="sc">&#39;1&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
	<span class="sc">&#39;2&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
	<span class="sc">&#39;3&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
	<span class="c1">//...
</span><span class="c1"></span>	<span class="sc">&#39;V&#39;</span><span class="p">:</span> <span class="mi">31</span><span class="p">,</span>
	<span class="sc">&#39;W&#39;</span><span class="p">:</span> <span class="mi">32</span><span class="p">,</span>
	<span class="sc">&#39;X&#39;</span><span class="p">:</span> <span class="mi">33</span><span class="p">,</span>
<span class="p">}</span></code></pre></div>
<p>我们提供一个编解码的方法，用于将字符串转换为一组号码。对应的，将一组号码转换为长度为7的字符串。</p>

<p>随机红号范围控制在<code>1-33</code>，蓝号控制在<code>1-16</code>。所以，我们对当前纳秒进行取余，便可以保证数据的正确。对于去重部分，通过<code>map</code>属性来达到目的，<code>map</code>的<code>key</code>存储生成的随机号，<code>value</code>存储对应的编码。因为<code>map</code>结构读取数据时本身也是随机的，所以在生成红号和蓝号的时候便多生成一部分，最后再取6个红号，1个蓝号。</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">TwoColor</span> <span class="kd">struct</span> <span class="p">{</span>
<span class="p">}</span>

<span class="c1">//encode
</span><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">color</span> <span class="o">*</span><span class="nx">TwoColor</span><span class="p">)</span> <span class="nf">Encode</span><span class="p">(</span><span class="nx">origin</span> <span class="p">[]</span><span class="kt">int</span><span class="p">)</span> <span class="kt">string</span> <span class="p">{</span>
	<span class="nx">runes</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">rune</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
	<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">v</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">origin</span> <span class="p">{</span>
		<span class="k">if</span> <span class="nx">elem</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">redBall</span><span class="p">[</span><span class="nx">v</span><span class="p">];</span> <span class="nx">ok</span> <span class="p">{</span>
			<span class="nx">runes</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">runes</span><span class="p">,</span> <span class="nx">elem</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="nb">string</span><span class="p">(</span><span class="nx">runes</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">//decode
</span><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">color</span> <span class="o">*</span><span class="nx">TwoColor</span><span class="p">)</span> <span class="nf">Decode</span><span class="p">(</span><span class="nx">origin</span> <span class="kt">string</span><span class="p">)</span> <span class="p">[]</span><span class="kt">int</span> <span class="p">{</span>
	<span class="nx">result</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">int</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
	<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">v</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">origin</span> <span class="p">{</span>
		<span class="k">if</span> <span class="nx">elem</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">redFlip</span><span class="p">[</span><span class="nx">v</span><span class="p">];</span> <span class="nx">ok</span> <span class="p">{</span>
			<span class="nx">result</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="nx">elem</span><span class="p">)</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="nx">result</span>
<span class="p">}</span>

<span class="c1">//generate random numbers
</span><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">color</span> <span class="o">*</span><span class="nx">TwoColor</span><span class="p">)</span> <span class="nf">GenerateRandom</span><span class="p">()</span> <span class="kt">string</span> <span class="p">{</span>
	<span class="nx">redResult</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="kt">rune</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
	<span class="k">for</span> <span class="nb">len</span><span class="p">(</span><span class="nx">redResult</span><span class="p">)</span> <span class="p">&lt;</span> <span class="mi">12</span> <span class="p">{</span>
		<span class="nx">key</span> <span class="o">:=</span> <span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">().</span><span class="nf">Nanosecond</span><span class="p">()</span><span class="o">%</span><span class="mi">33</span> <span class="o">+</span> <span class="mi">1</span>
		<span class="nx">redResult</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="p">=</span> <span class="nx">redBall</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>
	<span class="p">}</span>

	<span class="nx">blueBall</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="kt">rune</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
	<span class="k">for</span> <span class="nb">len</span><span class="p">(</span><span class="nx">blueBall</span><span class="p">)</span> <span class="p">&lt;</span> <span class="mi">2</span> <span class="p">{</span>
		<span class="nx">key</span> <span class="o">:=</span> <span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">().</span><span class="nf">Nanosecond</span><span class="p">()</span><span class="o">%</span><span class="mi">16</span> <span class="o">+</span> <span class="mi">1</span>
		<span class="nx">blueBall</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="p">=</span> <span class="nx">redBall</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>
	<span class="p">}</span>

	<span class="nx">index</span> <span class="o">:=</span> <span class="mi">0</span>
	<span class="nx">result</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">rune</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
	<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">v</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">redBall</span> <span class="p">{</span>
		<span class="nx">index</span><span class="o">++</span>
		<span class="nx">result</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="nx">v</span><span class="p">)</span>
		<span class="k">if</span> <span class="nx">index</span> <span class="o">==</span> <span class="mi">6</span> <span class="p">{</span>
			<span class="k">break</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">v</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">blueBall</span> <span class="p">{</span>
		<span class="nx">result</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="nx">v</span><span class="p">)</span>
		<span class="k">break</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="nb">string</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span>
<span class="p">}</span></code></pre></div>
<h2 id="批量生成随机数">批量生成随机数</h2>

<p>批量生成不重复的随机数，核心就是解决如何存储的问题。每次都得跟之前生成的记录做比较，保证当前生成的记录是不重复的。</p>

<p>之所以有批量生成的需求，首先是为了使生成的记录更随机。其次，试想一下，如果你内存足够大，生成<code>5000W</code>条记录，官方开奖后，看看这<code>5000W</code>会不会中一注。如果这么多都没有中，那真是一件令人伤心的事情啊。</p>

<p>为了简单方便，我们直接将生成的记录存储到本地内存中，这里使用前面讲到的<a href="https://github.com/allegro/bigcache"><code>bigcache</code></a>。我们将生成的记录作为<code>Key</code>，<code>Value</code>不存储实际的值了。</p>

<p><strong>对于<code>ZSet</code></strong>，我们这里只想体现它的唯一属性。只有当记录不存在时才进行存储。</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">DBCenter</span> <span class="kd">struct</span> <span class="p">{</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">db</span> <span class="o">*</span><span class="nx">DBCenter</span><span class="p">)</span> <span class="nf">ZSet</span><span class="p">(</span><span class="nx">key</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span> <span class="nx">db</span><span class="p">.</span><span class="nf">Exists</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">return</span>
	<span class="p">}</span>
	<span class="nx">cache</span><span class="p">.</span><span class="nf">Set</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="kc">nil</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">db</span> <span class="o">*</span><span class="nx">DBCenter</span><span class="p">)</span> <span class="nf">Exists</span><span class="p">(</span><span class="nx">key</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">bool</span> <span class="p">{</span>
	<span class="nx">_</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">cache</span><span class="p">.</span><span class="nf">Get</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="k">if</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">err</span><span class="p">.(</span><span class="o">*</span><span class="nx">bigcache</span><span class="p">.</span><span class="nx">EntryNotFoundError</span><span class="p">);</span> <span class="nx">ok</span> <span class="p">{</span>
			<span class="k">return</span> <span class="kc">false</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="kc">true</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">db</span> <span class="o">*</span><span class="nx">DBCenter</span><span class="p">)</span> <span class="nf">Len</span><span class="p">()</span> <span class="kt">int</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nx">cache</span><span class="p">.</span><span class="nf">Len</span><span class="p">()</span>
<span class="p">}</span></code></pre></div>
<p>批量生成的过程就是一个<code>for</code>循环的过程，并通过<code>Len</code>方法获取当前生成的记录数。</p>

<h2 id="存储开奖号码">存储开奖号码</h2>

<p>将每期的开奖号码作为下一期的参考，是每个迷信中彩人的执着。</p>

<p>我们选择将每期的中奖号码存储到文件中，实在没有必要使用关系型数据库。在使用过程中，我们不会部署到多台服务器上。这个项目就是在个人电脑上运行设计的，单文件存储足够了。</p>

<p><strong>关于<code>write</code>方法</strong>，写入的内容包括日期和中奖号码，连接符使用了<code>SeparatorData</code>。在打开文件的模式中，我们指定了<code>O_APPEND</code>，将写入追加到文件末尾。这也导致最新的开奖号码出现在文件的末尾。当读取最近几期的开奖号码时，需要定位开始读取的位置。</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">const</span> <span class="p">(</span>
	<span class="nx">FilePath</span>      <span class="p">=</span> <span class="s">&#34;/Users/neojos/src/boredom/data/history.txt&#34;</span>
	<span class="nx">SeparatorData</span> <span class="p">=</span> <span class="s">&#34;\t&#34;</span>
<span class="p">)</span>

<span class="kd">type</span> <span class="nx">FileData</span> <span class="kd">struct</span> <span class="p">{</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">f</span> <span class="o">*</span><span class="nx">FileData</span><span class="p">)</span> <span class="nf">GetLatestHistory</span><span class="p">(</span><span class="nx">limit</span> <span class="kt">int64</span><span class="p">)</span> <span class="p">([]</span><span class="kt">string</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">file</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nf">OpenFile</span><span class="p">(</span><span class="nx">FilePath</span><span class="p">,</span> <span class="nx">os</span><span class="p">.</span><span class="nx">O_CREATE</span><span class="p">|</span><span class="nx">os</span><span class="p">.</span><span class="nx">O_RDONLY</span><span class="p">,</span> <span class="mo">0755</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="k">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">err</span>
	<span class="p">}</span>
	<span class="k">defer</span> <span class="nx">file</span><span class="p">.</span><span class="nf">Close</span><span class="p">()</span>

	<span class="nx">info</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">file</span><span class="p">.</span><span class="nf">Stat</span><span class="p">()</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="k">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">err</span>
	<span class="p">}</span>

	<span class="nx">rowLength</span> <span class="o">:=</span> <span class="mi">0</span>
	<span class="nx">scan</span> <span class="o">:=</span> <span class="nx">bufio</span><span class="p">.</span><span class="nf">NewScanner</span><span class="p">(</span><span class="nx">file</span><span class="p">)</span>
	<span class="k">for</span> <span class="nx">scan</span><span class="p">.</span><span class="nf">Scan</span><span class="p">()</span> <span class="p">{</span>
		<span class="nx">rowLength</span> <span class="p">=</span> <span class="nb">len</span><span class="p">(</span><span class="nx">scan</span><span class="p">.</span><span class="nf">Text</span><span class="p">())</span> <span class="o">+</span> <span class="mi">1</span> <span class="c1">//&#39;\n&#39;
</span><span class="c1"></span>		<span class="k">break</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">scan</span><span class="p">.</span><span class="nf">Err</span><span class="p">();</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="k">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">err</span>
	<span class="p">}</span>

	<span class="nx">result</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">string</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
	<span class="nx">file</span><span class="p">.</span><span class="nf">Seek</span><span class="p">((</span><span class="nx">info</span><span class="p">.</span><span class="nf">Size</span><span class="p">()</span><span class="o">/</span><span class="nb">int64</span><span class="p">(</span><span class="nx">rowLength</span><span class="p">)</span><span class="o">-</span><span class="nx">limit</span><span class="p">)</span><span class="o">*</span><span class="nb">int64</span><span class="p">(</span><span class="nx">rowLength</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
	<span class="nx">scan</span> <span class="p">=</span> <span class="nx">bufio</span><span class="p">.</span><span class="nf">NewScanner</span><span class="p">(</span><span class="nx">file</span><span class="p">)</span>
	<span class="k">for</span> <span class="nx">scan</span><span class="p">.</span><span class="nf">Scan</span><span class="p">()</span> <span class="p">{</span>
		<span class="nx">tmp</span> <span class="o">:=</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">Split</span><span class="p">(</span><span class="nx">scan</span><span class="p">.</span><span class="nf">Text</span><span class="p">(),</span> <span class="nx">SeparatorData</span><span class="p">)</span>
		<span class="nx">result</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="nx">tmp</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="nx">tmp</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">scan</span><span class="p">.</span><span class="nf">Err</span><span class="p">();</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="k">return</span> <span class="nx">result</span><span class="p">,</span> <span class="nx">err</span>
	<span class="p">}</span>

	<span class="nx">reverseResult</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">string</span><span class="p">,</span> <span class="nx">limit</span><span class="p">)</span>
	<span class="k">for</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">v</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">result</span> <span class="p">{</span>
		<span class="nx">reverseResult</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="nx">limit</span><span class="p">)</span><span class="o">-</span><span class="nx">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">=</span> <span class="nx">v</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="nx">reverseResult</span><span class="p">,</span> <span class="kc">nil</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">f</span> <span class="o">*</span><span class="nx">FileData</span><span class="p">)</span> <span class="nf">Write</span><span class="p">(</span><span class="nx">date</span><span class="p">,</span> <span class="nx">number</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
	<span class="nx">file</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nf">OpenFile</span><span class="p">(</span><span class="nx">FilePath</span><span class="p">,</span> <span class="nx">os</span><span class="p">.</span><span class="nx">O_CREATE</span><span class="p">|</span><span class="nx">os</span><span class="p">.</span><span class="nx">O_WRONLY</span><span class="p">|</span><span class="nx">os</span><span class="p">.</span><span class="nx">O_APPEND</span><span class="p">,</span> <span class="mo">0755</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="k">return</span> <span class="nx">err</span>
	<span class="p">}</span>
	<span class="k">defer</span> <span class="nx">file</span><span class="p">.</span><span class="nf">Close</span><span class="p">()</span>

	<span class="nx">line</span> <span class="o">:=</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="s">&#34;%s\t%s\n&#34;</span><span class="p">,</span> <span class="nx">date</span><span class="p">,</span> <span class="nx">number</span><span class="p">)</span>
	<span class="nx">_</span><span class="p">,</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">file</span><span class="p">.</span><span class="nf">WriteString</span><span class="p">(</span><span class="nx">line</span><span class="p">)</span>
	<span class="k">return</span> <span class="nx">err</span>
<span class="p">}</span></code></pre></div>
<p><strong><code>GetLatestHistory</code></strong>用于获取最近几期的开奖号码。因为每行写入的长度相同，所以通过计算，可以得出当前文件的行数，并将文件的<code>offset</code>定位到指定的位置，从具体的<code>offset</code>开始读取。另外，因为我们写入的模式是<code>APPEND</code>，所以将获取到的<code>slice</code>再做一次顺序反转，便得到最近几期的开奖记录了。</p>

<h2 id="生成图">生成图</h2>

<p>通过<a href="https://github.com/gonum/plot"><code>plot</code></a>来绘制一些简易的图形。将最近的开奖号码作为数据源，来观察数据的走势。虽然确实没啥用处。</p>

<p>这段代码直接运行会<code>panic</code>，因为修改了<code>plot</code>中的部分代码。</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">Curve</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="nx">elements</span> <span class="p">[][]</span><span class="kt">int</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">curve</span> <span class="o">*</span><span class="nx">Curve</span><span class="p">)</span> <span class="nf">SetElem</span><span class="p">(</span><span class="nx">input</span> <span class="p">[][]</span><span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">curve</span><span class="p">.</span><span class="nx">elements</span> <span class="p">=</span> <span class="nx">input</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">curve</span> <span class="o">*</span><span class="nx">Curve</span><span class="p">)</span> <span class="nf">GetBaseImg</span><span class="p">()</span> <span class="kt">error</span> <span class="p">{</span>
	<span class="nx">pic</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">plot</span><span class="p">.</span><span class="nf">New</span><span class="p">()</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="k">return</span> <span class="nx">err</span>
	<span class="p">}</span>

	<span class="nx">pic</span><span class="p">.</span><span class="nx">X</span><span class="p">.</span><span class="nx">Label</span><span class="p">.</span><span class="nx">Text</span> <span class="p">=</span> <span class="s">&#34;ball&#34;</span>
	<span class="nx">pic</span><span class="p">.</span><span class="nx">Y</span><span class="p">.</span><span class="nx">Label</span><span class="p">.</span><span class="nx">Text</span> <span class="p">=</span> <span class="s">&#34;number&#34;</span>

	<span class="c1">// Draw a grid behind the data
</span><span class="c1"></span>	<span class="nx">pic</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="nx">plotter</span><span class="p">.</span><span class="nf">NewGrid</span><span class="p">())</span>

	<span class="nx">customTick</span> <span class="o">:=</span> <span class="nx">commaTicks</span><span class="p">{</span>
		<span class="nx">CustomTicks</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
	<span class="p">}</span>
	<span class="nx">pic</span><span class="p">.</span><span class="nx">X</span><span class="p">.</span><span class="nx">Tick</span><span class="p">.</span><span class="nx">Marker</span> <span class="p">=</span> <span class="nx">customTick</span>

	<span class="nx">customTick</span><span class="p">.</span><span class="nx">CustomTicks</span> <span class="p">=</span> <span class="mi">33</span>
	<span class="nx">pic</span><span class="p">.</span><span class="nx">Y</span><span class="p">.</span><span class="nx">Tick</span><span class="p">.</span><span class="nx">Marker</span> <span class="p">=</span> <span class="nx">customTick</span>

	<span class="nx">picElem</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">plotter</span><span class="p">.</span><span class="nx">XYer</span><span class="p">)</span>
	<span class="k">for</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">element</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">curve</span><span class="p">.</span><span class="nx">elements</span> <span class="p">{</span>
		<span class="nx">points</span> <span class="o">:=</span> <span class="nx">plotter</span><span class="p">.</span><span class="nx">XYs</span><span class="p">{}</span>
		<span class="k">for</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">v</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">element</span> <span class="p">{</span>
			<span class="nx">points</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">points</span><span class="p">,</span> <span class="nx">plotter</span><span class="p">.</span><span class="nx">XY</span><span class="p">{</span><span class="nx">X</span><span class="p">:</span> <span class="nb">float64</span><span class="p">(</span><span class="nx">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="nx">Y</span><span class="p">:</span> <span class="nb">float64</span><span class="p">(</span><span class="nx">v</span><span class="p">)})</span>
		<span class="p">}</span>
		<span class="nx">picElem</span><span class="p">[</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="s">&#34;%d&#34;</span><span class="p">,</span> <span class="nx">index</span><span class="p">)]</span> <span class="p">=</span> <span class="nx">points</span>
	<span class="p">}</span>

	<span class="nx">plotutil</span><span class="p">.</span><span class="nf">AddLinePoints</span><span class="p">(</span><span class="nx">pic</span><span class="p">,</span> <span class="nx">picElem</span><span class="p">)</span>
	<span class="k">return</span> <span class="nx">pic</span><span class="p">.</span><span class="nf">Save</span><span class="p">(</span><span class="nx">vgsvg</span><span class="p">.</span><span class="nx">DefaultWidth</span><span class="p">,</span> <span class="nx">vgsvg</span><span class="p">.</span><span class="nx">DefaultWidth</span><span class="p">,</span> <span class="s">&#34;base.png&#34;</span><span class="p">)</span>
<span class="p">}</span></code></pre></div>
<p>生成的图片如下：</p>

<p><img src="https://i.loli.net/2019/02/09/5c5eb729854c9.png" alt="pic" /></p>

<h2 id="总结">总结</h2>

<p>项目的代码在<a href="https://github.com/GitHubSi/boredom"><code>boredom</code></a>，代码非常简单。祝大家早日中大奖！</p>
</article>
        

        
        
        
    </main>
    
    <footer class="flex-container footer"></footer>
    
    
</body>

</html>