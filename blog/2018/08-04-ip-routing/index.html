<!DOCTYPE html>
<html>

<head>
    
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="chrome=1">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="referrer" content="no-referrer">

<meta name="description" content="Hugo-Primer theme&#39;s example site">
<title>
    IP Routing - 渐行渐远
</title>









<link rel="stylesheet" href="/css/main.min.2b94ebec8e27e619a30001ec15c2d8caef5baadcb64d3790c11926340da8d22c.css" integrity="sha256-K5Tr7I4n5hmjAAHsFcLYyu9bqty2TTeQwRkmNA2o0iw=" crossorigin="anonymous" media="screen">





<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Didact+Gothic">
<script
        src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
        crossorigin="anonymous"></script>

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="IP Routing"/>
<meta name="twitter:description" content="假设你在跟小米公司对接服务，那你有没有好奇过：自家的服务器是如何找到小米公司的服务器的。为了安全，公司的服务器可都是在内网的，用户是无法直接"/>

<meta property="og:title" content="IP Routing" />
<meta property="og:description" content="假设你在跟小米公司对接服务，那你有没有好奇过：自家的服务器是如何找到小米公司的服务器的。为了安全，公司的服务器可都是在内网的，用户是无法直接" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://neojos.com/blog/2018/08-04-ip-routing/" />
<meta property="article:published_time" content="2018-08-04T00:00:00&#43;00:00"/>
<meta property="article:modified_time" content="2018-08-04T00:00:00&#43;00:00"/>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-12345678-0', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

    

    
    
    
    <title>
        
        IP Routing
        
    </title>
</head>

<body>
    
    
    <header class="wrap flex-container">
        <h1>IP Routing</h1>
    </header>
    
    <main class="wrap">
        
        <article role="article" class="flex-container">

<p>假设你在跟小米公司对接服务，那你有没有好奇过：自家的服务器是如何找到小米公司的服务器的。为了安全，公司的服务器可都是在内网的，用户是无法直接访问到的。好好了解一下Ip Routing，它可以给你部分答案。</p>

<h2 id="概述">概述</h2>

<p>当主机<code>IP(Network)</code>层收到一个<code>datagram</code>后，它首先会检查<code>datagram</code>的目标主机是不是自己。如果是，那么它会将<code>datagram</code>发送给其他协议处理。如果不是，它便检查自己是否被配置作为一个路由。如果是，它将按照规则将<code>datagram</code>继续传递。否则，默默的把<code>datagram</code>丢掉。</p>

<p>所有<code>routing</code>提供的<code>IP</code>地址，都假设下一个<code>hop</code>是离目标地址最近的。在<code>datagram</code>传递的过程中，我们会修改<code>link-layer</code>的地址为下一个<code>hop</code>的地址，而<code>Destination IP</code>一般是不做修改的。</p>

<h2 id="routing-table"><code>Routing Table</code></h2>

<p>在命令行执行 <code>netstat -rn</code>，查看系统的<code>routing table</code>。</p>

<pre><code># 展示结果做了修改，非真实值

neojos@BJ ~ $ netstat -rn
Kernel IP routing table
Destination     Gateway         Genmask         Flags   MSS Window  irtt Iface
140.168.0.0     10.3.206.240   255.255.0.0     UG        0 0          0 eth0
</code></pre>

<h3 id="了解-falgs-参数">了解<code>Falgs</code>参数：</h3>

<ol>
<li><code>U</code>  表示当前路由是在使用的</li>
<li><code>G</code>  表示路由到一个<code>gateway</code>。如果没有设置该<code>flag</code>，则表示跟<code>Destination</code>是直接连接的。</li>
<li><code>H</code>  表示路由到一个主机地址。如果没有设置该<code>flag</code>，则<code>Destination</code>是一个网络地址。</li>
<li><code>D</code>  表示路由是通过<code>ICMP Redirect</code>设置的。一般来说，<code>Redirect</code>设置的<code>route</code>都是主机地址。</li>
</ol>

<h3 id="路由查询的顺序">路由查询的顺序：</h3>

<ol>
<li>查找匹配的主机地址</li>
<li>查找匹配的网络地址</li>
<li>查找<code>default</code>的路由。</li>
</ol>

<h2 id="host-unreachable"><code>Host unreachable</code></h2>

<p>当<code>route</code>没有找到<code>destination</code>时，<code>Destination Host Unreachable</code>的错误会返回给源主机。你可以通过<code>ping</code>路由表中配置错误的<code>destination host address</code>来查看。</p>

<h2 id="icmp-redirect-error"><code>ICMP Redirect Error</code></h2>
</article>
        

        
        
        
    </main>
    
    <footer class="flex-container footer"></footer>
    
    
</body>

</html>