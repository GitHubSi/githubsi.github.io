<!DOCTYPE html>
<html>
  <head>
    
    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-12345678-0', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>
      
  Shell必备基础（1） &ndash; 渐行渐远

    </title>
    
    
    <meta name="description" property="og:description" content="Shell是对Linux命令的深加工，用得好，事半功倍。 本来只想加深Array的用法，但一不小心，又变成了一篇基础大全。 比较运算 习惯在if语|Hugo-Primer theme&#39;s example site">
    

    <meta name="apple-mobile-web-app-title" content="渐行渐远">
    
    
    
    
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@">
    <meta name="twitter:creator" content="@">
    <meta name="twitter:title" content="Shell必备基础（1） | 渐行渐远">
    <meta name="twitter:description" content="Shell是对Linux命令的深加工，用得好，事半功倍。 本来只想加深Array的用法，但一不小心，又变成了一篇基础大全。 比较运算 习惯在if语|Hugo-Primer theme&#39;s example site">
    <meta name="twitter:image" content="https://neojos.com/twitter-card.png">
    


    <link rel="stylesheet" href="/assets/syntax.css">
    <link rel="stylesheet" href="/assets/primer-build.css">
    <link rel="stylesheet" href="/assets/style.css">
  </head>


  <body class="bg-gray">
    <div id="holy" class="container-lg bg-white h-100">

      <div id="header" class="px-1 bg-white">
        <nav class="UnderlineNav UnderlineNav--right px-2">
  <a class="UnderlineNav-actions muted-link h2" href="https://neojos.com/">
    渐行渐远
  </a>

  
  
</nav>

      </div>

      <div role="main" id="main" class="holy-main markdown-body px-4 bg-white">
        

<div class="Subhead">
  <div class="Subhead-heading">
    <div class="h1 mt-3 mb-1">Shell必备基础（1）</div>
  </div>
  <div class="Subhead-description">
    




<a href='/tags/linux' class="muted-link">
  <span class="Label Label--gray">linux</span>
</a>



    
    <div class="float-md-right">
      <span title="Lastmod: 2018-08-09. Published at: 2018-08-09.">
        
          Published: 2018-08-09
        
      </span>
    </div>
    
  </div>
</div>
<article>
  
  <section class="pb-6 mb-3 border-bottom">
    

<p><code>Shell</code>是对<code>Linux</code>命令的深加工，用得好，事半功倍。 本来只想加深<code>Array</code>的用法，但一不小心，又变成了一篇基础大全。</p>

<h2 id="比较运算">比较运算</h2>

<p>习惯在<code>if</code>语句中使用<code>[[...]]</code>对条件进行比较，字符串、数值以及文件，统统笑纳。</p>

<h3 id="算数比较">算数比较</h3>

<p>常用的操作符有<code>-eq</code>、<code>-ne</code>、<code>-gt</code>、<code>-lt</code>、<code>-le</code>等。</p>

<h3 id="文件系统">文件系统</h3>

<p>当编译文件、或者查看<code>pid</code>文件、日志时会经常用到。</p>

<pre><code>[ -e $var ] 如果指定的变量包含的文件存在，则返回真
[ -f $var ] 如果指定的变量包含正常的文件路径或文件名，则返回真
</code></pre>

<h3 id="字符串比较">字符串比较</h3>

<p>判空还是相当常见的操作。比如，查看当前系统是否启用了<code>notify</code>的进程，如果有的话，<code>kill</code>掉。</p>

<pre><code>pid=`ps -ef | grep notify | grep -v 'grep' | awk '{print $2}'`
if [[ -n $pid ]]
then
    echo -e &quot;\033[31m Kill掉当前正在运行的进程... \033[0m\n&quot;
    kill $pid
fi
</code></pre>

<p>常见的操作符如下：</p>

<pre><code>[[ -z $str ]]   如果str包含的是空字符串，则返回真
[[ -n $str ]]   如果str包含的是非空字符串，则返回真
</code></pre>

<p>其他的操作符包括：<code>==</code>、<code>!=</code>、<code>&gt;</code>、<code>&lt;</code></p>

<h3 id="逻辑运算">逻辑运算</h3>

<p>使用逻辑<code>&amp;&amp;</code>和<code>||</code>来表示与和或的逻辑关系。</p>

<p>比如</p>

<pre><code>if [[ -n $str ]] &amp;&amp; [[ -z $str ]]
then
    echo $str
fi
</code></pre>

<h2 id="基本语句-example">基本语句<code>Example</code></h2>

<h3 id="if-语句"><code>if</code>语句</h3>

<pre><code>if command1
then
    # ...
elif command2
then
    # ...
else
    # ...
fi
</code></pre>

<h3 id="while-语句"><code>while</code>语句</h3>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="k">while</span> <span class="o">[</span> <span class="m">1</span> <span class="o">]</span> 
<span class="k">do</span>
    <span class="nb">echo</span> <span class="nv">$RANDOM</span>
<span class="k">done</span></code></pre></div>
<h3 id="for-语句"><code>for</code>语句</h3>

<p><code>for</code>循环总是以空格、<code>\t</code>、<code>\n</code>作为分隔符。如果要明确指定分隔符的话，使用<code>IFS</code>明确声明。</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="nv">SERVER</span><span class="o">=(</span>
    <span class="c1"># server list</span>
    <span class="s2">&#34;node025.add.neojos.net&#34;</span>
    <span class="s2">&#34;node026.add.neojos.net&#34;</span>
    <span class="s2">&#34;node062.add.neojos.net&#34;</span>
    <span class="s2">&#34;node063.add.neojos.net&#34;</span>
<span class="o">)</span>

<span class="c1">#${SERVER[@]}其实就是一个用空格implode起来各个元素的组合字符串</span>
<span class="k">for</span> var in <span class="si">${</span><span class="nv">SERVER</span><span class="p">[@]</span><span class="si">}</span>
<span class="k">do</span>
    <span class="nb">echo</span> <span class="nv">$var</span><span class="p">;</span>
<span class="k">done</span></code></pre></div>
<h3 id="case-语句"><code>case</code>语句</h3>

<pre><code>case $OPT in
        i)
            NEED_BUILD=false
            ;;
        b)
            BUILD_FILE=$OPTARG
            ;;
    esac
</code></pre>

<h2 id="数组">数组</h2>

<p>定义一个数组，元素间使用空格或者<code>\n</code>进行分隔。</p>

<pre><code>task=(&quot;delivery&quot; &quot;notify&quot; &quot;event&quot;)
</code></pre>

<p>要访问其中的元素，需要知道它的下标：</p>

<pre><code>echo ${task[0]} ${task[1]} 
</code></pre>

<p>经常会用到的获取数组的方式（<code>*</code>可以用来替换<code>@</code>）：</p>

<pre><code>${task[@]}      #数组所有元素的value
${!task[@]}     #数组所有元素的key
${#task[@]}     #数组元素的个数
</code></pre>

<p>下面列举几个简单的例子：</p>

<pre><code>#!/bin/bash

arr=(
	one
	two
	three
	[6]=six
)

echo &quot;Array size :&quot; ${#arr[@]}
# Array size : 4
</code></pre>

<h2 id="函数">函数</h2>

<p>函数的声明：</p>

<pre><code>function deploy()
{
    # 在函数体内部，通过 $n 的形式来获取参数的值
    server=$1;
    echo -e &quot;start deploy \033[0;34m$server\033[0m; put y to continue, put n to quit:&quot;
    read line

    if [ &quot;$line&quot; != &quot;y&quot; ]; then
        return
    fi
}

</code></pre>

<p>函数的调用。函数名会在<code>$0</code>变量中定义，函数命令行上的任何参数都需要通过<code>$1</code>,<code>$2</code>&hellip;来定义。还可以通过<code>$#</code>来判断参数的个数。</p>

<pre><code>for server in &quot;${SERVER[@]}&quot;
do
    deploy $server
done
</code></pre>

<p>获取参数的具体形式：</p>

<pre><code>$#  传递到脚本的参数个数
$*  以一个单字符串形式向脚本传递参数。如果是&quot;$*&quot;，会输出&quot;$1 $2 … $n&quot;的形式。
$@  与$*相同，但是使用时加引号，并在引号中返回每个参数。
</code></pre>

<p>参考文章：</p>

<ol>
<li><a href="https://www.linuxjournal.com/content/bash-arrays">Bash Array</a></li>
</ol>

  </section>

  <section>
    
      
    
  </section>
</article>

      </div>

      <div id="side" class="pr-1 bg-white">
        <aside class="pr-3">
          
  
    <div id="toc" class="Box Box--blue mb-3">
      <b>Shell必备基础（1）</b><nav id="TableOfContents"><ul>
<li><a href="#比较运算">比较运算</a>
<ul>
<li><a href="#算数比较">算数比较</a></li>
<li><a href="#文件系统">文件系统</a></li>
<li><a href="#字符串比较">字符串比较</a></li>
<li><a href="#逻辑运算">逻辑运算</a></li>
</ul></li>
<li><a href="#基本语句-example">基本语句<code>Example</code></a>
<ul>
<li><a href="#if-语句"><code>if</code>语句</a></li>
<li><a href="#while-语句"><code>while</code>语句</a></li>
<li><a href="#for-语句"><code>for</code>语句</a></li>
<li><a href="#case-语句"><code>case</code>语句</a></li>
</ul></li>
<li><a href="#数组">数组</a></li>
<li><a href="#函数">函数</a></li>
</ul></li>
</ul>
</nav></div>
  

  
    <div>
      
    </div>
  

        </aside>
      </div>

      <div id="footer" class="pt-2 pb-3 bg-white text-center">
        

  <span class="text-small text-gray">
    &copy;Qiushi Pan 2018-2019 &middot; 

    Powered by the
    <a href="https://github.com/qqhann/hugo-primer" class="link-gray-dark">Hugo-Primer</a> theme for
    <a href="https://gohugo.io" class="link-gray-dark">Hugo</a>.
  </span>


      </div>
    </div>

    
    
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });</script>
    
  </body>
</html>
