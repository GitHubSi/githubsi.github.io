<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>Deafult Decimal - 渐行渐远</title>
    <meta property="og:title" content="Deafult Decimal - 渐行渐远">
    

    
      
    

    

    
    


<link href='//cdn.bootcss.com/highlight.js/9.14.1/styles/googlecode.min.css' rel='stylesheet' type='text/css' />



    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    <link rel="stylesheet" href="/css/custom.css" />
    <link rel="stylesheet" href="/css/custom.css" />

  </head>

  
  <body class="blog">
    <header class="masthead">
      <h1 class="headimg">
    
    <a href="/"><img src="/img/headimg.png" alt="Fuhui "></a>
</h1>



      <nav class="menu">
        <input id="menu-check" type="checkbox" />
        <label id="menu-label" for="menu-check" class="unselectable">
          <span class="icon close-icon">✕</span>
          <span class="icon open-icon">☰</span>
          <span class="text">Menu</span>
        </label>
        <ul>
        
        
        <li><a href="/blog/">Blog</a></li>
        
        <li><a href="/life/">Life</a></li>
        
        <li><a href="/categories/">Categories</a></li>
        
        <li><a href="/tags/">Tags</a></li>
        
        <li><a href="/about/">About</a></li>
        
        </ul>
      </nav>

      
      <div id="bar" style="position:absolute;z-index:99;background-color:Red;">
        

  <div class="Box Box--blue p-2 mb-3 mt-5">
    <a href="/tags/" class="link-gray-dark">
      <h4>Tags</h4>
    </a>
    
    <span class="css-truncate no-wrap m-1 pl-1">
      <a href="/tags/2018" class="link-gray text-emphasized css-truncate-target"><span class="">2018th</span></a>
      <span class="text-right Counter">1</span>
    </span>
    
    <span class="css-truncate no-wrap m-1 pl-1">
      <a href="/tags/dailylife" class="link-gray text-emphasized css-truncate-target"><span class="">Daily life</span></a>
      <span class="text-right Counter">3</span>
    </span>
    
    <span class="css-truncate no-wrap m-1 pl-1">
      <a href="/tags/mq" class="link-gray text-emphasized css-truncate-target"><span class="">M q</span></a>
      <span class="text-right Counter">1</span>
    </span>
    
    <span class="css-truncate no-wrap m-1 pl-1">
      <a href="/tags/mysql" class="link-gray text-emphasized css-truncate-target"><span class="">My s q l</span></a>
      <span class="text-right Counter">5</span>
    </span>
    
    <span class="css-truncate no-wrap m-1 pl-1">
      <a href="/tags/think" class="link-gray text-emphasized css-truncate-target"><span class="">Think</span></a>
      <span class="text-right Counter">4</span>
    </span>
    
    <span class="css-truncate no-wrap m-1 pl-1">
      <a href="/tags/cache" class="link-gray text-emphasized css-truncate-target"><span class="">Cache</span></a>
      <span class="text-right Counter">2</span>
    </span>
    
    <span class="css-truncate no-wrap m-1 pl-1">
      <a href="/tags/design-pattern" class="link-gray text-emphasized css-truncate-target"><span class="">Design pattern</span></a>
      <span class="text-right Counter">1</span>
    </span>
    
    <span class="css-truncate no-wrap m-1 pl-1">
      <a href="/tags/docker" class="link-gray text-emphasized css-truncate-target"><span class="">Docker</span></a>
      <span class="text-right Counter">1</span>
    </span>
    
    <span class="css-truncate no-wrap m-1 pl-1">
      <a href="/tags/git" class="link-gray text-emphasized css-truncate-target"><span class="">Git</span></a>
      <span class="text-right Counter">2</span>
    </span>
    
    <span class="css-truncate no-wrap m-1 pl-1">
      <a href="/tags/golang" class="link-gray text-emphasized css-truncate-target"><span class="">Golang</span></a>
      <span class="text-right Counter">34</span>
    </span>
    
    <span class="css-truncate no-wrap m-1 pl-1">
      <a href="/tags/http" class="link-gray text-emphasized css-truncate-target"><span class="">Http</span></a>
      <span class="text-right Counter">1</span>
    </span>
    
    <span class="css-truncate no-wrap m-1 pl-1">
      <a href="/tags/js" class="link-gray text-emphasized css-truncate-target"><span class="">Js</span></a>
      <span class="text-right Counter">1</span>
    </span>
    
    <span class="css-truncate no-wrap m-1 pl-1">
      <a href="/tags/linux" class="link-gray text-emphasized css-truncate-target"><span class="">Linux</span></a>
      <span class="text-right Counter">5</span>
    </span>
    
    <span class="css-truncate no-wrap m-1 pl-1">
      <a href="/tags/mongo" class="link-gray text-emphasized css-truncate-target"><span class="">Mongo</span></a>
      <span class="text-right Counter">2</span>
    </span>
    
    <span class="css-truncate no-wrap m-1 pl-1">
      <a href="/tags/mysql" class="link-gray text-emphasized css-truncate-target"><span class="">Mysql</span></a>
      <span class="text-right Counter">1</span>
    </span>
    
    <span class="css-truncate no-wrap m-1 pl-1">
      <a href="/tags/net" class="link-gray text-emphasized css-truncate-target"><span class="">Net</span></a>
      <span class="text-right Counter">8</span>
    </span>
    
    <span class="css-truncate no-wrap m-1 pl-1">
      <a href="/tags/nginx" class="link-gray text-emphasized css-truncate-target"><span class="">Nginx</span></a>
      <span class="text-right Counter">1</span>
    </span>
    
    <span class="css-truncate no-wrap m-1 pl-1">
      <a href="/tags/npm" class="link-gray text-emphasized css-truncate-target"><span class="">Npm</span></a>
      <span class="text-right Counter">1</span>
    </span>
    
    <span class="css-truncate no-wrap m-1 pl-1">
      <a href="/tags/pay" class="link-gray text-emphasized css-truncate-target"><span class="">Pay</span></a>
      <span class="text-right Counter">1</span>
    </span>
    
    <span class="css-truncate no-wrap m-1 pl-1">
      <a href="/tags/php" class="link-gray text-emphasized css-truncate-target"><span class="">Php</span></a>
      <span class="text-right Counter">1</span>
    </span>
    
    <span class="css-truncate no-wrap m-1 pl-1">
      <a href="/tags/protobufs" class="link-gray text-emphasized css-truncate-target"><span class="">Protobufs</span></a>
      <span class="text-right Counter">1</span>
    </span>
    
    <span class="css-truncate no-wrap m-1 pl-1">
      <a href="/tags/protocol" class="link-gray text-emphasized css-truncate-target"><span class="">Protocol</span></a>
      <span class="text-right Counter">1</span>
    </span>
    
    <span class="css-truncate no-wrap m-1 pl-1">
      <a href="/tags/tcp/ip" class="link-gray text-emphasized css-truncate-target"><span class="">Tcp/ip</span></a>
      <span class="text-right Counter">5</span>
    </span>
    
    <span class="css-truncate no-wrap m-1 pl-1">
      <a href="/tags/think" class="link-gray text-emphasized css-truncate-target"><span class="">Think</span></a>
      <span class="text-right Counter">1</span>
    </span>
    
    <span class="css-truncate no-wrap m-1 pl-1">
      <a href="/tags/tools" class="link-gray text-emphasized css-truncate-target"><span class="">Tools</span></a>
      <span class="text-right Counter">6</span>
    </span>
    
    <span class="css-truncate no-wrap m-1 pl-1">
      <a href="/tags/transaction" class="link-gray text-emphasized css-truncate-target"><span class="">Transaction</span></a>
      <span class="text-right Counter">3</span>
    </span>
    
    <span class="css-truncate no-wrap m-1 pl-1">
      <a href="/tags/translate" class="link-gray text-emphasized css-truncate-target"><span class="">Translate</span></a>
      <span class="text-right Counter">14</span>
    </span>
    
    <span class="css-truncate no-wrap m-1 pl-1">
      <a href="/tags/%e7%bb%9f%e8%ae%a1" class="link-gray text-emphasized css-truncate-target"><span class="">统计</span></a>
      <span class="text-right Counter">1</span>
    </span>
    
  </div>




  <div class="Box Box--blue p-2 mb-3">
    <a href="/categories/" class="link-gray-dark">
      <h4>Categories</h4>
    </a>
    
    <span class="css-truncate no-wrap m-1 pl-1">
      <a href="/categories/2018-01" class="link-gray text-emphasized css-truncate-target"><span class="">2018 01</span></a>
      <span class="text-right Counter">5</span>
    </span>
    
    <span class="css-truncate no-wrap m-1 pl-1">
      <a href="/categories/2018-02" class="link-gray text-emphasized css-truncate-target"><span class="">2018 02</span></a>
      <span class="text-right Counter">2</span>
    </span>
    
    <span class="css-truncate no-wrap m-1 pl-1">
      <a href="/categories/2018-03" class="link-gray text-emphasized css-truncate-target"><span class="">2018 03</span></a>
      <span class="text-right Counter">3</span>
    </span>
    
    <span class="css-truncate no-wrap m-1 pl-1">
      <a href="/categories/2018-04" class="link-gray text-emphasized css-truncate-target"><span class="">2018 04</span></a>
      <span class="text-right Counter">4</span>
    </span>
    
    <span class="css-truncate no-wrap m-1 pl-1">
      <a href="/categories/2018-05" class="link-gray text-emphasized css-truncate-target"><span class="">2018 05</span></a>
      <span class="text-right Counter">4</span>
    </span>
    
    <span class="css-truncate no-wrap m-1 pl-1">
      <a href="/categories/2018-06" class="link-gray text-emphasized css-truncate-target"><span class="">2018 06</span></a>
      <span class="text-right Counter">2</span>
    </span>
    
    <span class="css-truncate no-wrap m-1 pl-1">
      <a href="/categories/2018-07" class="link-gray text-emphasized css-truncate-target"><span class="">2018 07</span></a>
      <span class="text-right Counter">7</span>
    </span>
    
    <span class="css-truncate no-wrap m-1 pl-1">
      <a href="/categories/2018-08" class="link-gray text-emphasized css-truncate-target"><span class="">2018 08</span></a>
      <span class="text-right Counter">6</span>
    </span>
    
    <span class="css-truncate no-wrap m-1 pl-1">
      <a href="/categories/2018-09" class="link-gray text-emphasized css-truncate-target"><span class="">2018 09</span></a>
      <span class="text-right Counter">2</span>
    </span>
    
    <span class="css-truncate no-wrap m-1 pl-1">
      <a href="/categories/2018-10" class="link-gray text-emphasized css-truncate-target"><span class="">2018 10</span></a>
      <span class="text-right Counter">3</span>
    </span>
    
    <span class="css-truncate no-wrap m-1 pl-1">
      <a href="/categories/2018-11" class="link-gray text-emphasized css-truncate-target"><span class="">2018 11</span></a>
      <span class="text-right Counter">2</span>
    </span>
    
    <span class="css-truncate no-wrap m-1 pl-1">
      <a href="/categories/2018-12" class="link-gray text-emphasized css-truncate-target"><span class="">2018 12</span></a>
      <span class="text-right Counter">3</span>
    </span>
    
    <span class="css-truncate no-wrap m-1 pl-1">
      <a href="/categories/2019-01" class="link-gray text-emphasized css-truncate-target"><span class="">2019 01</span></a>
      <span class="text-right Counter">4</span>
    </span>
    
    <span class="css-truncate no-wrap m-1 pl-1">
      <a href="/categories/2019-02" class="link-gray text-emphasized css-truncate-target"><span class="">2019 02</span></a>
      <span class="text-right Counter">5</span>
    </span>
    
    <span class="css-truncate no-wrap m-1 pl-1">
      <a href="/categories/2019-03" class="link-gray text-emphasized css-truncate-target"><span class="">2019 03</span></a>
      <span class="text-right Counter">8</span>
    </span>
    
    <span class="css-truncate no-wrap m-1 pl-1">
      <a href="/categories/2019-04" class="link-gray text-emphasized css-truncate-target"><span class="">2019 04</span></a>
      <span class="text-right Counter">5</span>
    </span>
    
    <span class="css-truncate no-wrap m-1 pl-1">
      <a href="/categories/2019-05" class="link-gray text-emphasized css-truncate-target"><span class="">2019 05</span></a>
      <span class="text-right Counter">2</span>
    </span>
    
    <span class="css-truncate no-wrap m-1 pl-1">
      <a href="/categories/2019-06" class="link-gray text-emphasized css-truncate-target"><span class="">2019 06</span></a>
      <span class="text-right Counter">4</span>
    </span>
    
    <span class="css-truncate no-wrap m-1 pl-1">
      <a href="/categories/2019-07" class="link-gray text-emphasized css-truncate-target"><span class="">2019 07</span></a>
      <span class="text-right Counter">1</span>
    </span>
    
    <span class="css-truncate no-wrap m-1 pl-1">
      <a href="/categories/2019-08" class="link-gray text-emphasized css-truncate-target"><span class="">2019 08</span></a>
      <span class="text-right Counter">1</span>
    </span>
    
    <span class="css-truncate no-wrap m-1 pl-1">
      <a href="/categories/2019-09" class="link-gray text-emphasized css-truncate-target"><span class="">2019 09</span></a>
      <span class="text-right Counter">1</span>
    </span>
    
    <span class="css-truncate no-wrap m-1 pl-1">
      <a href="/categories/2019-10" class="link-gray text-emphasized css-truncate-target"><span class="">2019 10</span></a>
      <span class="text-right Counter">3</span>
    </span>
    
    <span class="css-truncate no-wrap m-1 pl-1">
      <a href="/categories/2019-11" class="link-gray text-emphasized css-truncate-target"><span class="">2019 11</span></a>
      <span class="text-right Counter">3</span>
    </span>
    
    <span class="css-truncate no-wrap m-1 pl-1">
      <a href="/categories/2019-12" class="link-gray text-emphasized css-truncate-target"><span class="">2019 12</span></a>
      <span class="text-right Counter">1</span>
    </span>
    
    <span class="css-truncate no-wrap m-1 pl-1">
      <a href="/categories/2019-17" class="link-gray text-emphasized css-truncate-target"><span class="">2019 17</span></a>
      <span class="text-right Counter">1</span>
    </span>
    
    <span class="css-truncate no-wrap m-1 pl-1">
      <a href="/categories/summarize" class="link-gray text-emphasized css-truncate-target"><span class="">Summarize</span></a>
      <span class="text-right Counter">1</span>
    </span>
    
  </div>


      </div>

    </header>

    <article class="main">
      <header class="title">
      <h1>Deafult Decimal</h1>




    
    
    <section class="post-meta">
        <span class="post-author">付辉
        
            
            
             /  2018-12-01
            
        </span>
        
        <a href="/tags/mysql">MySQL</a>
        
    </section>
    



<hr>
      </header>

        <script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-2.1.1.min.js"></script>
        <script type="text/javascript">
            var height = parseInt($("#bar").css("top"))
            $(function () {
                $(window).scroll(function () {
                    var currentH = $(document).scrollTop();
                    if (currentH > height) {
                        $("#bar").css("top", (currentH) + 'px');
                    } else {
                        $('#bar').css('top', height + 'px');
                    }

                });
            });
        </script>



<p><em><u>版本 0.00</u></em></p>

<blockquote>
<p>我说：<code>version dependent</code> 表示我们的思考时，应该依赖具体的版本。举个例子，你把2015年看到的一些<code>redis</code>机制拿到现在跟别人谈论，很容易闹出笑话。在3年的时间里，它可能已经做了无数的优化。所以，思考要与时俱进。</p>
</blockquote>

<h2 id="引言">引言</h2>

<h3 id="在涉及到支付业务的时候-数据库里的钱怎么存">在涉及到支付业务的时候，数据库里的钱怎么存：</h3>

<ol>
<li>存储单位是元。在业务处理的时候就会涉及到浮点数，很多商家喜欢将价钱定义为<code>0.99</code>而不是<code>1</code>元。这在使用过程中非常忌讳<strong>是否相等</strong>的比较。浮点数的比较经常喜欢用<code>|floatA - floatB| &gt; 0.00001</code>来，很多第三方库也提供了比较方法。</li>
<li>存储单位时分。为了避免浮点类型比较时的不确定性，决定使用整形来替代。一般来说没有问题，可如果是要严格缺心眼打折，比如给一个售价<code>4.99</code>的打<code>5折</code>，那么最后就会存在<code>5里</code>的情况。一般都喜欢向上取整，应收用户<code>2.495</code>，实收用户<code>2.50</code>.</li>
</ol>

<h3 id="那么在-mysql-的-column-中该如何存储呢">那么在<code>MySQL</code>的<code>Column</code>中该如何存储呢？</h3>

<ol>
<li>如果是分的话，肯定时当整形来存储的。但如果时浮点的，大家都会选择<code>decimal</code>，因为该类型不会丢失精度。</li>
<li>存储为字符串。浮点数保留指定位数的字符串。在<code>Go</code>中我也尝试过，<code>fmt.Sprintf(&quot;%.2f&quot;, 3.091)</code>还是靠谱的。</li>
</ol>

<p>这篇文章当然不是来分析这两种存储方式的，也不是来分析该存储什么数据类型的。而仅仅时想阐述一个之前不了解的知识点（知识点太少，写点别的来凑）。</p>

<h2 id="deault-value"><code>deault value</code></h2>

<p>在<code>MySQL</code>建表的过程中，一般都会指定<code>DEFAULT VALUE</code>。在执行<code>INSERT</code>时，如果不指定该字段，<code>MySQL</code>会默认使用该默认值来替代。下面是创建的一个<code>decimal</code>类型字段，在<code>Go</code>中使用<a href="https://github.com/go-xorm/xorm"><code>xorm</code></a> 来表示，可以看出，<code>xorm</code>使用字符串类型来接收<code>decimal</code>类型的值。</p>

<pre><code class="language-go">type table_test struct {
    PayPrice  string  `xorm:&quot;not null default 0.00 comment('支付价钱') DECIMAL(10,2)&quot;`
}
</code></pre>

<p>最后发现：在测试环境下，向数据库插入记录时，不指定<code>PayPrice</code>没有任何问题。但到了正式服数据表插入便失败了。报错信息如下：</p>

<pre><code>{
    &quot;Number&quot;: 1366,
    &quot;Message&quot;: &quot;Incorrect decimal value: '' for column 'pay_price' at row 1&quot;
}
</code></pre>

<h2 id="strict-trans-tables"><code>STRICT_TRANS_TABLES</code></h2>

<p>查询<code>sql_mode</code>如下：</p>

<pre><code>show variables like 'sql_mode'
</code></pre>

<p>下面的内容截取至:<a href="https://dev.mysql.com/doc/refman/8.0/en/sql-mode.html#sql-mode-strict"><code>Strict SQL Mode</code></a>:</p>

<blockquote>
<p><code>Strict mode controls how MySQL handles invalid or missing values in data-change statements such as INSERT or UPDATE. A value can be invalid for several reasons. For example, it might have the wrong data type for the column, or it might be out of range.</code></p>
</blockquote>

<p>最终定位：<strong>空字符串在该模式下转换decimal会失败，测试和线上数据库环境不一致</strong></p>


  <footer>
  
<nav class="post-nav">
  <span class="nav-prev">&larr; <a href="/blog/2018/11-20-nss%E5%88%9D%E7%AA%A5/">NSS初窥</a></span>
  <span class="nav-next"><a href="/blog/2018/2018.12.09-net-transport/">Net Transport</a> &rarr;</span>
</nav>





<script src="//yihui.name/js/math-code.js"></script>
<script async src="//cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>

<script async src="//yihui.name/js/center-img.js"></script>
  



<script src="//cdn.bootcss.com/highlight.js/9.14.1/highlight.min.js"></script>



<script src="//cdn.bootcss.com/highlight.js/9.14.1/languages/r.min.js"></script>
<script src="//cdn.bootcss.com/highlight.js/9.14.1/languages/yaml.min.js"></script>
<script src="//cdn.bootcss.com/highlight.js/9.14.1/languages/tex.min.js"></script>
<script src="//cdn.bootcss.com/highlight.js/9.14.1/languages/go.min.js"></script>
<script>hljs.configure({languages: []}); hljs.initHighlightingOnLoad();</script>



  
  <hr>
  <div class="copyright">&copy; <a href="http://neojos.com">DDF</a> 2017 | <a href="https://github.com/GitHubSi">Github</a> | <a href="http://blog.csdn.net/whynottrythis">CSDN</a> | <a href="https://segmentfault.com/u/neojos">segmentfault</a></div>
  
  </footer>
  </article>
  
  </body>
</html>

